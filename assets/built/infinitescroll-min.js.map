{"version":3,"sources":["infinitescroll.js"],"names":["initInfiniteScroll","n","t","r","querySelector","i","o","l","s","c","scrollY","u","innerHeight","d","documentElement","scrollHeight","addEventListener","a","passive","m","v","f","this","status","removeEventListener","response","querySelectorAll","forEach","e","appendChild","href","XMLHttpRequest","responseType","open","send","requestAnimationFrame","window","document"],"mappings":"AAAA,SAASA,mBAAmBC,EAAEC,GAAG,IAAIC,EAAED,EAAEE,cAAc,kBAAkB,GAAGD,EAAE,CAAC,IAAIE,EAAEH,EAAEE,cAAc,cAAc,GAAGC,EAAE,CAAC,IAAIC,EAAE,IAAIC,GAAE,EAAGC,GAAE,EAAGC,EAAER,EAAES,QAAQC,EAAEV,EAAEW,YAAYC,EAAEX,EAAEY,gBAAgBC,aAAad,EAAEe,iBAAiB,SAASC,EAAE,CAACC,SAAQ,IAAKjB,EAAEe,iBAAiB,SAASG,GAAGC,KAAK,SAASC,IAAI,GAAG,MAAMC,KAAKC,OAAO,OAAOtB,EAAEuB,oBAAoB,SAASP,QAAQhB,EAAEuB,oBAAoB,SAASL,GAAGG,KAAKG,SAASC,iBAAiB,cAAcC,QAAQ,SAASC,GAAGvB,EAAEwB,YAAYD,KAAK,IAAIA,EAAEN,KAAKG,SAASrB,cAAc,kBAAkBwB,EAAEzB,EAAE2B,KAAKF,EAAEE,MAAM7B,EAAEuB,oBAAoB,SAASP,GAAGhB,EAAEuB,oBAAoB,SAASL,IAAIN,EAAEX,EAAEY,gBAAgBC,aAAaP,EAAED,GAAE,EAAG,SAASqB,IAAI,IAAIpB,EAAE,GAAGC,EAAEE,GAAGE,EAAEP,EAAEC,GAAE,MAAO,CAACC,GAAE,EAAG,IAAIoB,EAAE,IAAI3B,EAAE8B,eAAeH,EAAEI,aAAa,WAAWJ,EAAEZ,iBAAiB,OAAOK,GAAGO,EAAEK,KAAK,MAAM9B,EAAE2B,MAAMF,EAAEM,KAAK,OAAO,SAASd,IAAIb,GAAGN,EAAEkC,sBAAsBP,GAAGrB,GAAE,EAAG,SAASU,IAAIR,EAAER,EAAES,QAAQU,IAAI,SAASD,IAAIR,EAAEV,EAAEW,YAAYC,EAAEX,EAAEY,gBAAgBC,aAAaK,KAAKpB,mBAAmBoC,OAAOC","sourcesContent":["/**\n * Infinite Scroll\n */\n\nfunction initInfiniteScroll(window, document) {\n    // next link element\n    var nextElement = document.querySelector('link[rel=next]');\n    if (!nextElement) return;\n\n    // post feed element\n    var feedElement = document.querySelector('.post-feed');\n    if (!feedElement) return;\n\n    var buffer = 300;\n\n    var ticking = false;\n    var loading = false;\n\n    var lastScrollY = window.scrollY;\n    var lastWindowHeight = window.innerHeight;\n    var lastDocumentHeight = document.documentElement.scrollHeight;\n\n    function onPageLoad() {\n        if (this.status === 404) {\n            window.removeEventListener('scroll', onScroll);\n            window.removeEventListener('resize', onResize);\n            return;\n        }\n\n        // append contents\n        var postElements = this.response.querySelectorAll('.post-card');\n        postElements.forEach(function (item) {\n            feedElement.appendChild(item);\n        });\n\n        // set next link\n        var resNextElement = this.response.querySelector('link[rel=next]');\n        if (resNextElement) {\n            nextElement.href = resNextElement.href;\n        } else {\n            window.removeEventListener('scroll', onScroll);\n            window.removeEventListener('resize', onResize);\n        }\n\n        // sync status\n        lastDocumentHeight = document.documentElement.scrollHeight;\n        ticking = false;\n        loading = false;\n    }\n\n    function onUpdate() {\n        // return if already loading\n        if (loading) return;\n\n        // return if not scroll to the bottom\n        if (lastScrollY + lastWindowHeight <= lastDocumentHeight - buffer) {\n            ticking = false;\n            return;\n        }\n\n        loading = true;\n\n        var xhr = new window.XMLHttpRequest();\n        xhr.responseType = 'document';\n\n        xhr.addEventListener('load', onPageLoad);\n\n        xhr.open('GET', nextElement.href);\n        xhr.send(null);\n    }\n\n    function requestTick() {\n        ticking || window.requestAnimationFrame(onUpdate);\n        ticking = true;\n    }\n\n    function onScroll() {\n        lastScrollY = window.scrollY;\n        requestTick();\n    }\n\n    function onResize() {\n        lastWindowHeight = window.innerHeight;\n        lastDocumentHeight = document.documentElement.scrollHeight;\n        requestTick();\n    }\n\n    window.addEventListener('scroll', onScroll, { passive: true });\n    window.addEventListener('resize', onResize);\n\n    requestTick();\n};\n\ninitInfiniteScroll(window, document);\n"]}